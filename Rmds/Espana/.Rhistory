morultimodia=299
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=order(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
morultimodia=290
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=order(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
morultimodia=290
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=order(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
morultimodia=299
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=order(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
reaisi[ncol(mortos_raw)-r]
morultimodia=reaisi[ncol(mortos_raw)-r]
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
morultimodia=reaisi[ncol(mortos_raw)-r]
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=sort(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
morultimodia=299
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=sort(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
caben=reaisi[3:(ncol(mortos_raw)-r)]
caben
morultimodia=299
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=sort(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r+1)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-3),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
erro
erro[1]
erro
erro[1]
err1o[]
erro[1]
caben
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-3),caben,-1)
mortosconreais=rbind(aceptados,moreais)
View(mortosconreais)
reais
mortos_raw
moreais
length(moreais)
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
length(moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1))
length(moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1))
length(moreais)
morultimodia=as.double(erro[1])
morultimodia
morultimodia=as.double(erro[1])
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=sort(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r+1)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
morultimodia=as.double(erro[1])
reais
datas=seq( as.Date("2020-03-03")-r, by=1, len=d-1)
names(i1_raw)[-1]=format(datas,"%Y-%m-%d")
names(i2_raw)[-1]=format(datas,"%Y-%m-%d")
names(i3_raw)[-1]=format(datas,"%Y-%m-%d")
names(r1_raw)[-1]=format(datas,"%Y-%m-%d")
names(r2_raw)[-1]=format(datas,"%Y-%m-%d")
names(mortos_raw)[-1]=format(datas,"%Y-%m-%d")
names(mortos_raw)
reaisi
morultimodia
library("tidyr")
library("ggplot2")
# library("fda.usc")
# trayectorias= mortos_raw[,-1]
# datosfda= fdata(trayectorias)
# plot(datosfda)
#setwd("~/Modelo_Covid_descargado/Results/Vasco/")
##############################
##### CAMBIAR DENDE AQUÍ #####
##############################
i=16 #indice da autonomia
i1_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_I1.txt")
i2_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_I2.txt")
i3_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_I3.txt")
r1_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_R1.txt")
r2_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_R2.txt")
mortos_raw=read.table("../../src/Results/Espana/Vasco/SimulaVasco_XM.txt")
erro=read.table("../../src/Results/Espana/Vasco/SimulaVasco_Error.txt")
autonomias=read.csv("../../Data/Espana_Autonomias.csv",header=TRUE,sep='\t')
reais=read.csv("../../Data/Espana_ccaa_covid19_fallecidos.csv",header=TRUE,sep=',')
####################
##### ATA AQUI #####
####################
reaisi=as.numeric(reais[(reais$cod_ine)==i,])
nceros=0
j=0
while(reaisi[j+3]==0) {
nceros=nceros+1
j=j+1
}
d=ncol(mortos_raw)
r= 18-nceros#numero de dias con antelacion cos que empeza o simulador
datas=seq( as.Date("2020-03-03")-r, by=1, len=d-1)
names(i1_raw)[-1]=format(datas,"%Y-%m-%d")
names(i2_raw)[-1]=format(datas,"%Y-%m-%d")
names(i3_raw)[-1]=format(datas,"%Y-%m-%d")
names(r1_raw)[-1]=format(datas,"%Y-%m-%d")
names(r2_raw)[-1]=format(datas,"%Y-%m-%d")
names(mortos_raw)[-1]=format(datas,"%Y-%m-%d")
morultimodia=as.double(erro[1])
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=sort(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r+1)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
reais
reaisi
morultimodia
View(mortos_raw)
reais
aceptados$V1
View(aceptados)
knitr::opts_chunk$set(echo = TRUE)
library("tidyr")
library("ggplot2")
# library("fda.usc")
# trayectorias= mortos_raw[,-1]
# datosfda= fdata(trayectorias)
# plot(datosfda)
#setwd("~/Modelo_Covid_descargado/Results/Galicia/")
##############################
##### CAMBIAR DENDE AQUÍ #####
##############################
i=12 #indice da autonomia
i1_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_I1.txt")
i2_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_I2.txt")
i3_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_I3.txt")
r1_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_R1.txt")
r2_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_R2.txt")
mortos_raw=read.table("../../src/Results/Espana/Galicia/SimulaGalicia_XM.txt")
erro=read.table("../../src/Results/Espana/Galicia/SimulaGalicia_Error.txt")
autonomias=read.csv("../../Data/Espana_Autonomias.csv",header=TRUE,sep='\t')
reais=read.csv("../../Data/Espana_ccaa_covid19_fallecidos.csv",header=TRUE,sep=',')
####################
##### ATA AQUI #####
####################
reaisi=as.numeric(reais[(reais$cod_ine)==i,])
nceros=0
j=0
while(reaisi[j+3]==0) {
nceros=nceros+1
j=j+1
}
d=ncol(mortos_raw)
r= 18-nceros#numero de dias con antelacion cos que empeza o simulador
datas=seq( as.Date("2020-03-03")-r, by=1, len=d-1)
names(i1_raw)[-1]=format(datas,"%Y-%m-%d")
names(i2_raw)[-1]=format(datas,"%Y-%m-%d")
names(i3_raw)[-1]=format(datas,"%Y-%m-%d")
names(r1_raw)[-1]=format(datas,"%Y-%m-%d")
names(r2_raw)[-1]=format(datas,"%Y-%m-%d")
names(mortos_raw)[-1]=format(datas,"%Y-%m-%d")
morultimodia=as.double(erro[1])
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
ordenados=mortos_raw[order(distancias),]
ordenados$dis=sort(distancias)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r+1)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2)),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
i1=i1_raw[aceptados$V1,]
i1$dis=aceptados$dis
i1ord=gather(i1,key="dia",value="cantos",-V1,-dis)
i1ord$dia=as.Date(i1ord$dia)
ggplot(i1ord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=1/((1+dis)^100)),colour='#00C08D',show.legend=FALSE) +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("% of I1 in ", autonomias$Comunidad[i]))
i2=i2_raw[aceptados$V1,]
i2$dis=aceptados$dis
i2ord=gather(i2,key="dia",value="cantos",-V1,-dis)
i2ord$dia=as.Date(i1ord$dia)
ggplot(i2ord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=1/((1+dis)^100)),colour='#00C08D',show.legend=FALSE) +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("% of I2 in ", autonomias$Comunidad[i]))
i3=i3_raw[aceptados$V1,]
i3$dis=aceptados$dis
i3ord=gather(i3,key="dia",value="cantos",-V1,-dis)
i3ord$dia=as.Date(i1ord$dia)
ggplot(i3ord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=1/((1+dis)^100)),colour='#00C08D',show.legend=FALSE) +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("% of I3 in ", autonomias$Comunidad[i]))
r1=r1_raw[aceptados$V1,]
r1$dis=aceptados$dis
r1ord=gather(r1,key="dia",value="cantos",-V1,-dis)
r1ord$dia=as.Date(r1ord$dia)
ggplot(r1ord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=1/((1+dis)^100)),colour='#00C08D',show.legend=FALSE) +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("% of R1 in ", autonomias$Comunidad[i]))
r2=r2_raw[aceptados$V1,]
r2$dis=aceptados$dis
r2ord=gather(r2,key="dia",value="cantos",-V1,-dis)
r2ord$dia=as.Date(r2ord$dia)
ggplot(r2ord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=1/((1+dis)^100)),colour='#00C08D',show.legend=FALSE) +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("% of R2 in ", autonomias$Comunidad[i]))
i=12 #indice da autonomia
i1_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_I1.txt")
i2_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_I2.txt")
i3_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_I3.txt")
r1_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_R1.txt")
r2_raw= read.table("../../src/Results/Espana/Galicia/SimulaGalicia_R2.txt")
mortos_raw=read.table("../../src/Results/Espana/Galicia/SimulaGalicia_XM.txt")
erro=read.table("../../src/Results/Espana/Galicia/SimulaGalicia_Error.txt")
autonomias=read.csv("../../Data/Espana_Autonomias.csv",header=TRUE,sep='\t')
reais=read.csv("../../Data/Espana_ccaa_covid19_fallecidos.csv",header=TRUE,sep=',')
nceros=0
j=0
while(reaisi[j+3]==0) {
nceros=nceros+1
j=j+1
}
nceros=0
j=0
while(reaisi[j+3]==0) {
nceros=nceros+1
j=j+1
}
nceros=0
j=0
while(reaisi[j+3]==0) {
nceros=nceros+1
j=j+1
}
reaisi=as.numeric(reais[(reais$cod_ine)==i,])
nceros=0
j=0
while(reaisi[j+3]==0) {
nceros=nceros+1
j=j+1
}
d=ncol(mortos_raw)
r= 18-nceros#numero de dias con antelacion cos que empeza o simulador
datas=seq( as.Date("2020-03-03")-r, by=1, len=d-1)
names(i1_raw)[-1]=format(datas,"%Y-%m-%d")
names(i2_raw)[-1]=format(datas,"%Y-%m-%d")
names(i3_raw)[-1]=format(datas,"%Y-%m-%d")
names(r1_raw)[-1]=format(datas,"%Y-%m-%d")
names(r2_raw)[-1]=format(datas,"%Y-%m-%d")
names(mortos_raw)[-1]=format(datas,"%Y-%m-%d")
names(mortos_raw)
reais
reaisi=as.numeric(reais[(reais$cod_ine)==i,])
reais
reaisi
datas
morultimodia=as.double(erro[1])
morultimodia
reaisi
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
distancias
hist(distancias)
ordenados=mortos_raw[order(distancias),]
View(ordenados)
ordenados$dis=sort(distancias)
index=order(distancias)
ordenados=mortos_raw[index,]
ordenados$dis=distancias[index]
index=order(distancias)
ordenados=mortos_raw[index,]
ordenados$dis=distancias[index]
View(ordenados)
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
library("fda.usc")
i1=i1_raw[aceptados$V1,]
View(i1)
library("fda.usc")
trayectorias= i1[,-c(1,ncol(i1))]
datosfda= fdata(trayectorias)
plot(datosfda)
trayectorias= i1[,-c(1,ncol(i1))]
datosfda= fdata(trayectorias)
plot(datosfda)
plot(datosfda)
plot(datosfda)
plot(datosfda)
aceptados$V1
caben=reaisi[3:(ncol(mortos_raw)-r+1)]
caben
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
moreais
length(moreais)
ncol(aceptados)
morultimodia=as.double(erro[1])
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
hist(distancias)
index=order(distancias)
ordenados=mortos_raw[index,]
ordenados$dis=distancias[index]
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r+1)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord$dia=as.Date(mord$dia)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2/(2*sd(dis)²))),colour='#00C08D',show.legend=FALSE) +
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2/(2*var(dis)))),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
length(moreais)
moreais
i=16 #indice da autonomia
i1_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_I1.txt")
i2_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_I2.txt")
i3_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_I3.txt")
r1_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_R1.txt")
r2_raw= read.table("../../src/Results/Espana/Vasco/SimulaVasco_R2.txt")
mortos_raw=read.table("../../src/Results/Espana/Vasco/SimulaVasco_XM.txt")
erro=read.table("../../src/Results/Espana/Vasco/SimulaVasco_Error.txt")
autonomias=read.csv("../../Data/Espana_Autonomias.csv",header=TRUE,sep='\t')
reais=read.csv("../../Data/Espana_ccaa_covid19_fallecidos.csv",header=TRUE,sep=',')
####################
##### ATA AQUI #####
####################
reaisi=as.numeric(reais[(reais$cod_ine)==i,])
nceros=0
j=0
while(reaisi[j+3]==0) {
nceros=nceros+1
j=j+1
}
d=ncol(mortos_raw)
r= 18-nceros#numero de dias con antelacion cos que empeza o simulador
datas=seq( as.Date("2020-03-03")-r, by=1, len=d-1)
names(i1_raw)[-1]=format(datas,"%Y-%m-%d")
names(i2_raw)[-1]=format(datas,"%Y-%m-%d")
names(i3_raw)[-1]=format(datas,"%Y-%m-%d")
names(r1_raw)[-1]=format(datas,"%Y-%m-%d")
names(r2_raw)[-1]=format(datas,"%Y-%m-%d")
names(mortos_raw)[-1]=format(datas,"%Y-%m-%d")
morultimodia=as.double(erro[1])
distancias=(abs(mortos_raw[,ncol(mortos_raw)]-morultimodia))
hist(distancias)
index=order(distancias)
ordenados=mortos_raw[index,]
ordenados$dis=distancias[index]
aceptados=ordenados[ordenados$dis<morultimodia*0.1,]
mortos=aceptados
caben=reaisi[3:(ncol(mortos_raw)-r+1)]
moreais=c(-1,rep(0,ncol(aceptados)-length(caben)-2),caben,-1)
mortosconreais=rbind(aceptados,moreais)
mord=gather(mortosconreais,key="dia",value="cantos",-V1,-dis)
mord$dia=as.Date(mord$dia)
ggplot(mord) +
geom_line(aes(dia, 100*cantos/autonomias$Población[i],group= V1,alpha=exp(-dis^2/(2*var(dis)))),colour='#00C08D',show.legend=FALSE) +
geom_point(data=mord[mord$dis==-1,],aes(dia, 100*cantos/autonomias$Población[i]),colour='black') +
scale_x_date() +
theme_bw() +
labs(x = "Date", y = "",
subtitle = paste("Fatality rate in ", autonomias$Comunidad[i]))
i1=i1_raw[aceptados$V1,]
i1$dis=aceptados$dis
reaisi
moreais
length(moreais)
mean(aceptados[,61])
